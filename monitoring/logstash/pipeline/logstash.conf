input {
  # TCP 소켓 입력 (Spring Boot에서 전송)
  tcp {
    port => 5044
    codec => json_lines
  }

  # Beats 입력 (Filebeat 등)
  beats {
    port => 5000
  }
}

filter {
  # 애플리케이션 로그 파싱
  if [app_name] == "hhplus-ecommerce" {
    
    # DLQ 로그 태깅
    if [log_type] == "DLQ" {
      mutate {
        add_tag => ["dlq"]
      }
    }

    # 에러 레벨 태깅
    if [level] == "ERROR" {
      mutate {
        add_tag => ["error"]
      }
    }

    # 경고 레벨 태깅
    if [level] == "WARN" {
      mutate {
        add_tag => ["warning"]
      }
    }

    # 타임스탬프 파싱
    date {
      match => ["@timestamp", "ISO8601"]
      target => "@timestamp"
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "hhplus-ecommerce-%{+YYYY.MM.dd}"
  }

  # 디버그용 콘솔 출력
  # stdout { codec => rubydebug }
}

