# 부하 테스트 성능 비교 보고서

## 📋 개요

이 문서는 **부하테스트 환경(순수 DB)**과 **운영 환경(Redis + Kafka)**의 성능을 비교하여 인프라 개선 효과를 측정한 보고서입니다.

---

## 🔧 테스트 환경

### 부하테스트 환경 (순수 DB)

| 항목         | 설정                         |
| ------------ | ---------------------------- |
| Profile      | `load-test`                  |
| 데이터베이스 | MySQL                        |
| 캐시         | 비활성화                     |
| 메시지 큐    | 비활성화                     |
| 동시성 제어  | 비관적 락 (Pessimistic Lock) |
| 랭킹 조회    | DB 집계 쿼리                 |

### 운영 환경 (Redis + Kafka)

| 항목         | 설정              |
| ------------ | ----------------- |
| Profile      | `default`         |
| 데이터베이스 | MySQL             |
| 캐시         | Redis (TTL: 10분) |
| 메시지 큐    | Kafka             |
| 동시성 제어  | Redis 분산락      |
| 랭킹 조회    | Redis Sorted Set  |

---

## 📊 테스트 시나리오

### 1. 인기 상품 조회 (Product Ranking)

-   **VU**: 50명
-   **Duration**: 30초
-   **플로우**: 인기 상품 Top 조회

### 2. 선착순 쿠폰 발급 (Coupon Issue)

-   **VU**: 0 → 100명 (10초에 걸쳐 증가) → 30초 유지
-   **플로우**: 동시에 쿠폰 발급 요청 (동시성 경합)

### 3. 주문 및 결제 (Order & Payment)

-   **VU**: 100명
-   **Duration**: 30초
-   **플로우**: 주문 생성 → 결제 처리

---

## 📈 실제 테스트 결과

### 🔬 부하테스트 환경 결과 (순수 DB)

```json
{
    "랭킹 조회 성공": 523,
    "주문 생성 성공": 514,
    "결제 처리 성공": 55,
    "쿠폰 발급 성공": 55,
    "평균 랭킹 조회 시간 (ms)": "31.91",
    "평균 주문 시간 (ms)": "48.34",
    "평균 결제 시간 (ms)": "133.78",
    "p95 응답 시간 (ms)": "355.44"
}
```

### 🚀 운영 환경 결과 (Redis + Kafka)

```json
{
    "랭킹 조회 성공": 494,
    "주문 생성 성공": 495,
    "결제 처리 성공": 43,
    "쿠폰 발급 성공": 99,
    "평균 랭킹 조회 시간 (ms)": "37.15",
    "평균 주문 시간 (ms)": "15.36",
    "평균 결제 시간 (ms)": "19.69",
    "p95 응답 시간 (ms)": "87.64"
}
```

---

## 📊 성능 비교 분석

### 1. 응답 시간 비교

| 지표                    | 부하테스트 환경 (DB) | 운영 환경 (Redis+Kafka) | 변화              |
| ----------------------- | -------------------- | ----------------------- | ----------------- |
| **평균 랭킹 조회 시간** | 31.91 ms             | 37.15 ms                | +16.4% ⚠️         |
| **평균 주문 시간**      | 48.34 ms             | 15.36 ms                | **68.2% 개선** ✅ |
| **평균 결제 시간**      | 133.78 ms            | 19.69 ms                | **85.3% 개선** ✅ |
| **p95 응답 시간**       | 355.44 ms            | 87.64 ms                | **75.3% 개선** ✅ |

### 2. 처리량 비교

| 지표               | 부하테스트 환경 | 운영 환경 | 변화            |
| ------------------ | --------------- | --------- | --------------- |
| 랭킹 조회 성공     | 523건           | 494건     | -5.5%           |
| 주문 생성 성공     | 514건           | 495건     | -3.7%           |
| 결제 처리 성공     | 55건            | 43건      | -21.8% ⚠️       |
| **쿠폰 발급 성공** | 55건            | 99건      | **80% 증가** ✅ |

---

## 📊 시나리오별 분석

### 1️⃣ 인기 상품 조회

| 지표           | 부하테스트 환경 | 운영 환경 | 분석   |
| -------------- | --------------- | --------- | ------ |
| 평균 응답 시간 | 31.91 ms        | 37.15 ms  | +16.4% |
| 성공 조회 수   | 523건           | 494건     | -5.5%  |

**분석**:

-   부하테스트 환경: DB 집계 쿼리 사용, 단순 조회로 빠름
-   운영 환경: Redis Sorted Set 접근 + 네트워크 오버헤드 발생
-   ⚠️ 단일 조회에서는 DB가 더 빠르지만, **대규모 트래픽에서는 Redis가 DB 부하 분산**에 유리

> **참고**: 현재 테스트 규모에서는 Redis 오버헤드가 보이지만, 동시 접속자 1,000명 이상에서는 Redis의 캐시 히트가 DB보다 유리함

---

### 2️⃣ 선착순 쿠폰 발급

| 지표         | 부하테스트 환경 (비관적 락) | 운영 환경 (Redis 분산락) | 개선율          |
| ------------ | --------------------------- | ------------------------ | --------------- |
| 성공 발급 수 | 55건                        | 99건                     | **80% 증가** ✅ |

**분석**:

-   부하테스트 환경: DB 비관적 락으로 인한 심각한 경합 발생 → 55건만 성공
-   운영 환경: Redis 분산락으로 빠른 락 획득/해제 → 99건 성공
-   ✅ **가장 큰 개선 효과**: 동시성 제어 성능 **1.8배 향상**

---

### 3️⃣ 주문 생성

| 지표           | 부하테스트 환경 | 운영 환경 | 개선율            |
| -------------- | --------------- | --------- | ----------------- |
| 평균 주문 시간 | 48.34 ms        | 15.36 ms  | **68.2% 개선** ✅ |
| 주문 성공 수   | 514건           | 495건     | -3.7%             |

**분석**:

-   운영 환경에서 Kafka 비동기 이벤트 발행으로 **응답 시간 대폭 개선**
-   주문 처리 속도가 **3.1배 빨라짐**
-   트랜잭션 커밋 후 이벤트 발행으로 데이터 정합성 보장

---

### 4️⃣ 결제 처리

| 지표           | 부하테스트 환경 | 운영 환경 | 개선율            |
| -------------- | --------------- | --------- | ----------------- |
| 평균 결제 시간 | 133.78 ms       | 19.69 ms  | **85.3% 개선** ✅ |
| 결제 성공 수   | 55건            | 43건      | -21.8%            |

**분석**:

-   운영 환경에서 결제 처리 속도가 **6.8배 빨라짐**
-   Kafka 비동기 처리로 사용자 응답 시간 대폭 단축
-   결제 성공 건수 차이는 테스트 조건(재고, 잔액 등)에 따른 차이로 추정

---

## 📊 종합 비교

### 응답 시간 비교 (시각화)

```
평균 주문 시간:    [DB]      ████████████████ 48.34ms
                  [Redis]   █████ 15.36ms  ✅ 68.2% 개선

평균 결제 시간:    [DB]      ████████████████████████████████████████████ 133.78ms
                  [Redis]   ██████ 19.69ms  ✅ 85.3% 개선

p95 응답 시간:     [DB]      ████████████████████████████████████████████████████████████████████████████████████████████████████████████████████ 355.44ms
                  [Redis]   █████████████████████████████ 87.64ms  ✅ 75.3% 개선
```

### 핵심 지표 요약

| 항목               | 부하테스트 환경 | 운영 환경 | 종합 평가         |
| ------------------ | --------------- | --------- | ----------------- |
| **평균 주문 시간** | 48.34 ms        | 15.36 ms  | **68.2% 개선** ✅ |
| **평균 결제 시간** | 133.78 ms       | 19.69 ms  | **85.3% 개선** ✅ |
| **p95 응답 시간**  | 355.44 ms       | 87.64 ms  | **75.3% 개선** ✅ |
| **쿠폰 발급 성공** | 55건            | 99건      | **80% 증가** ✅   |

---

## 🎯 개선 효과 요약

### 1. ✅ 주문/결제 비동기 처리 (가장 큰 개선)

-   **기존**: 동기 트랜잭션 처리 (주문 → 결제 순차 실행)
-   **개선**: Kafka 기반 비동기 이벤트 처리
-   **효과**:
    -   주문 처리 시간 **68.2% 감소** (48.34ms → 15.36ms)
    -   결제 처리 시간 **85.3% 감소** (133.78ms → 19.69ms)
    -   시스템 결합도 감소

### 2. ✅ 쿠폰 발급 동시성 제어

-   **기존**: DB 비관적 락 (Pessimistic Lock) 사용
-   **개선**: Redis 분산락 (Distributed Lock) 사용
-   **효과**:
    -   성공 발급 수 **80% 증가** (55건 → 99건)
    -   락 경합으로 인한 실패 대폭 감소

### 3. ⚠️ 인기 상품 조회 (추가 최적화 필요)

-   **기존**: DB 집계 쿼리
-   **현재**: Redis Sorted Set
-   **현황**:
    -   단순 조회에서는 DB가 더 빠름 (31.91ms vs 37.15ms)
    -   Redis 네트워크 오버헤드 발생
-   **권장 개선**:
    -   로컬 캐시 (Caffeine) 추가 검토
    -   Redis 연결 풀 설정 최적화

---

## 🔍 결론

### 최종 평가

| 구분                 | 결과                             |
| -------------------- | -------------------------------- |
| **주문 처리 성능**   | ✅ **3.1배 향상** (68.2% 개선)   |
| **결제 처리 성능**   | ✅ **6.8배 향상** (85.3% 개선)   |
| **p95 응답 시간**    | ✅ **4배 향상** (75.3% 개선)     |
| **쿠폰 발급 성공률** | ✅ **1.8배 향상** (80% 증가)     |
| **인기 상품 조회**   | ⚠️ 추가 최적화 필요 (16.4% 증가) |

### 권장 사항

1. **Redis 분산락** 유지 - 동시성 제어에서 명확한 성능 향상
2. **Kafka 비동기 처리** 유지 - 주문/결제 응답 시간 대폭 개선
3. **인기 상품 조회** 최적화 - 로컬 캐시 (Caffeine) 2차 캐시 도입 검토
4. **Redis 연결 풀** 튜닝 - 연결 수, 타임아웃 설정 최적화

### 테스트 조건

-   **VU (Virtual Users)**: 50~100명
-   **테스트 시간**: 약 2분 20초
-   **데이터**: 사용자 100명, 상품 10개, 쿠폰 3개
