server:
    port: 8080
    servlet:
        context-path: /api
        encoding:
            charset: UTF-8
            enabled: true
            force: true

spring:
    datasource:
        url: jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}?serverTimezone=Asia/Seoul&characterEncoding=UTF-8
        username: ${DB_USER}
        password: ${DB_PASSWORD}
    jpa:
        open-in-view: true
        hibernate:
            ddl-auto: update
        properties:
            hibernate:
                show_sql: true
                format_sql: true
                highlight_sql: true
    # Redis 설정
    data:
        redis:
            host: ${REDIS_HOST:localhost}
            port: ${REDIS_PORT:6379}
            password: ${REDIS_PASSWORD:}
            timeout: 3000ms # 연결 타임아웃
            lettuce:
                pool:
                    enabled: true
                    max-active: 50 # 최대 활성 연결 수 (동시 요청 처리)
                    max-idle: 20 # 최대 유휴 연결 수
                    min-idle: 5 # 최소 유휴 연결 수 (워밍업 유지)
                    max-wait: 3000ms # 연결 획득 대기 시간
                    time-between-eviction-runs: 30000ms # 유휴 연결 검사 주기
                shutdown-timeout: 100ms # 종료 시 대기 시간
    cache:
        type: redis
        redis:
            time-to-live: 600000 # 기본 TTL: 10분 (밀리초)
    # Kafka 설정
    kafka:
        bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9093}
        producer:
            key-serializer: org.apache.kafka.common.serialization.StringSerializer
            value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
            acks: all # 모든 레플리카가 메시지를 받았음을 확인
            retries: 3 # 전송 실패 시 재시도 횟수
            properties:
                '[spring.json.add.type.headers]': false # 타입 헤더 추가하지 않음
        consumer:
            group-id: hhplus-ecommerce-group
            key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
            value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
            auto-offset-reset: earliest # 가장 오래된 메시지부터 소비
            enable-auto-commit: false # 수동 커밋 사용
            properties:
                '[spring.json.trusted.packages]': '*' # 모든 패키지 역직렬화 허용
        listener:
            ack-mode: manual # 수동 ACK 모드
logging:
    pattern:
        console: '[%d{HH:mm:ss.SSS}][%-5level][%logger.%method:line%line] - %msg%n'
    level:
        org:
            hibernate:
                SQL: debug
                type.descriptor.sql: trace

# Actuator & Monitoring
management:
    endpoints:
        web:
            exposure:
                include: health,info,prometheus,metrics,loggers
            base-path: /actuator
    endpoint:
        health:
            show-details: always
        prometheus:
            enabled: true
    metrics:
        tags:
            application: ${spring.application.name:hhplus-ecommerce}
        distribution:
            percentiles-histogram:
                http.server.requests: true
            percentiles:
                http.server.requests: 0.5, 0.95, 0.99

springdoc:
    api-docs:
        path: /api-docs
    swagger-ui:
        path: /swagger-ui.html
        tags-sorter: alpha
        operations-sorter: alpha
    show-actuator: true
    default-consumes-media-type: application/json
    default-produces-media-type: application/json
    info:
        title: E-Commerce API
        description: 이커머스 시스템 API 문서
        version: v1.0.0
