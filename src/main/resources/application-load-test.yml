# 부하 테스트용 Profile 설정
# 순수 DB만 사용하기 위해 Redis, Kafka 비활성화

# 성능 최적화 제거 설정
app:
  lock:
    enabled: false

spring:
  # Kafka 완전 비활성화
  kafka:
    enabled: false

  # Redis 완전 비활성화
  data:
    redis:
      repositories:
        enabled: false
  redis:
    enabled: false

  # 캐시 비활성화
  cache:
    type: none

  # AutoConfiguration 제외
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration
      - org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration
      - org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration

  datasource:
    url: jdbc:mysql://${DB_HOST}:${DB_PORT}/${DB_NAME}?serverTimezone=Asia/Seoul&characterEncoding=UTF-8
    username: ${DB_USER}
    password: ${DB_PASSWORD}

  # SQL 스크립트 자동 실행 설정
  sql:
    init:
      mode: always  # 항상 SQL 스크립트 실행
      data-locations: file:k6/data/load-test-data.sql  # K6 디렉토리의 테스트 데이터
      encoding: UTF-8
      continue-on-error: false  # 에러 발생 시 중단

  # 데이터베이스 상세 로깅 활성화
  jpa:
    defer-datasource-initialization: true  # Hibernate 스키마 생성 후 SQL 스크립트 실행
    properties:
      hibernate:
        show_sql: true
        format_sql: true
        highlight_sql: true
        use_sql_comments: true  # 쿼리에 주석 추가
        generate_statistics: true  # 통계 수집

logging:
  level:
    org:
      hibernate:
        SQL: debug
        type.descriptor.sql: trace
        stat: debug  # 통계 로깅
        orm.jdbc.bind: trace  # 바인딩 파라미터 로깅
    com.hhplus.ecommerce: debug  # 애플리케이션 로그
    org.springframework.transaction: debug  # 트랜잭션 로깅
    org.springframework.jdbc.core: debug  # JDBC 로깅